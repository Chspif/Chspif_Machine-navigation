---
import Layout from "../layouts/Layout.astro";
import Dashboard from "../components/Dashboard";
import ItemListSchema from "../components/schema/ItemListSchema.astro";
import BreadcrumbSchema from "../components/schema/BreadcrumbSchema.astro";
import data from "../data/tools.json";

export function getStaticPaths() {
  // Derive paths from data instead of hardcoding
  return data.tools.map((cat: any) => ({
    params: { category: cat.category }
  }));
}

const { category } = Astro.params;

// Get tools for this category
const categoryData = data.tools.find((cat: any) => cat.category === category);
const categoryTools = categoryData?.content || [];
const categoryTitle = categoryData?.title || category;

// Breadcrumb data
const breadcrumbs = [
  { name: "Home", url: "https://riseofmachine.com" },
  { name: categoryTitle },
];
---

<Layout
  site={`机器地图 - ${category}`}
  title="机器地图"
  tagline="寻找你需要的机器或物品"
  showSearch={true}
  searchPlaceholder={`Search in ${categoryTitle}...`}
>
  <ItemListSchema items={categoryTools} listName={`${categoryTitle} Tools`} />
  <BreadcrumbSchema items={breadcrumbs} />
  <main id="main-content">
    <Dashboard client:load category={category} transition:persist />
  </main>
</Layout>
