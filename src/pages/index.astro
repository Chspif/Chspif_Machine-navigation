---
import Layout from "../layouts/Layout.astro";

import Dashboard from "../components/Dashboard";
import OrganizationSchema from "../components/schema/OrganizationSchema.astro";
import ItemListSchema from "../components/schema/ItemListSchema.astro";
import data from "../data/tools.json";

async function loadCategoryData(category: string, file: string) {
    try {
        const module = await import(`../data/${file}`);
        return module.default;
    } catch (error) {
        console.error(`Failed to load category data for ${category}:`, error);
        return [];
    }
}

// Load all tools from all categories
const allTools = [];
for (const category of data.tools) {
    if (category.source === 'auto') {
        continue;
    } else if (category.content) {
        allTools.push(...category.content);
    } else if (category.file) {
        const tools = await loadCategoryData(category.category, category.file);
        allTools.push(...tools);
    }
}
---

<Layout
  site="机器地图"
  title="机器地图"
  tagline="搜索你需要的机器或物品"
  showSearch={true}
>
  <OrganizationSchema />
  <ItemListSchema items={allTools} listName="机器地图 - 所有物品" />
  <main id="main-content">
    <Dashboard client:load category="all-worlds" transition:persist />
  </main>
</Layout>
