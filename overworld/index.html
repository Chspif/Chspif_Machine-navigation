<!DOCTYPE html>
<html>

<head>
    <title>uNmINeD</title>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- OpenLayers  -->
    <link rel="stylesheet" type="text/css" href="lib/ol.css">
    <script src="lib/ol.js"></script>

    <!-- OpenLayers Context Menu -->
    <link href="lib/ol-contextmenu.css" rel="stylesheet">
    <script src="lib/ol-contextmenu.iife.js"></script>

    <!-- Toastify -->
    <script type="text/javascript" src="lib/toastify-js.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/toastify-js.min.css">


    <!-- Map metadata generated by uNmINeD -->
    <script type="text/javascript" src="unmined.map.properties.js"></script>
    <script type="text/javascript" src="unmined.map.regions.js"></script>
    <script type="text/javascript" src="unmined.map.players.js"></script>

    <!-- Custom markers -->
    <script type="text/javascript" src="custom.markers.js"></script>

    <!-- uNmINeD JS and CSS -->
    <script type="text/javascript" src="unmined.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">

</head>

<body>
    <!-- ä¾§è¾¹æ  -->
    <div id="sidebar">
        <div class="sidebar-header">
            <h2>åœ°å›¾æ ‡è®°</h2>
            <button id="toggle-sidebar" class="toggle-btn">Ã—</button>
        </div>
        
        <div class="sidebar-content">
            <div class="search-container">
                <input type="text" id="marker-search" placeholder="æœç´¢æ ‡è®°ç‚¹...">
            </div>
            
            <div class="markers-list-container">
                <h3>æ‰€æœ‰æ ‡è®°</h3>
                <ul id="markers-list"></ul>
            </div>
        </div>
    </div>

    <!-- ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® -->
    <button id="open-sidebar" class="open-btn">â˜°</button>

    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="map"></div>

    <script type="text/javascript">

        document.title = UnminedMapProperties.worldName + " - " + document.title;

        if (UnminedCustomMarkers && UnminedCustomMarkers.isEnabled && UnminedCustomMarkers.markers) {
            UnminedMapProperties.markers = UnminedMapProperties.markers.concat(UnminedCustomMarkers.markers);
        }
        
        if (UnminedPlayers && UnminedPlayers.length > 0) {
            UnminedMapProperties.playerMarkers = Unmined.createPlayerMarkers(UnminedPlayers);
        }

        const mapElement = document.getElementById('map');
        const unmined = new Unmined(mapElement, UnminedMapProperties, UnminedRegions);

        // ä¾§è¾¹æ åŠŸèƒ½
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggle-sidebar');
        const openBtn = document.getElementById('open-sidebar');
        const searchInput = document.getElementById('marker-search');
        const markersList = document.getElementById('markers-list');
        
        // è·å–æ‰€æœ‰æ ‡è®°ç‚¹
        const allMarkers = UnminedMapProperties.markers || [];
        
        // æ˜¾ç¤º/éšè—ä¾§è¾¹æ 
        toggleBtn.addEventListener('click', () => {
            sidebar.style.left = '-280px';
            openBtn.style.left = '10px';
        });
        
        openBtn.addEventListener('click', () => {
            sidebar.style.left = '0';
            openBtn.style.left = '290px';
        });
        
        // åˆ›å»ºæ ‡è®°ç‚¹åˆ—è¡¨
        function createMarkersList(markers) {
            markersList.innerHTML = '';
            
            if (markers.length === 0) {
                markersList.innerHTML = '<li class="no-markers">æ²¡æœ‰æ‰¾åˆ°æ ‡è®°ç‚¹</li>';
                return;
            }
            
            markers.forEach((marker, index) => {
                const li = document.createElement('li');
                li.className = 'marker-item';
                
                const name = marker.text || `æ ‡è®°ç‚¹ ${index + 1}`;
                const coords = `${Math.round(marker.x)}, ${Math.round(marker.z)}`;
                
                li.innerHTML = `
                    <div class="marker-name">${name}</div>
                    <div class="marker-coords">${coords}</div>
                `;
                
                // ç‚¹å‡»æ ‡è®°ç‚¹ï¼Œè·³è½¬åˆ°åœ°å›¾å¯¹åº”ä½ç½®
                li.addEventListener('click', () => {
                    unmined.center([marker.x, marker.z]);
                    
                    // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œç‚¹å‡»åå…³é—­ä¾§è¾¹æ 
                    if (window.innerWidth < 768) {
                        sidebar.style.left = '-280px';
                        openBtn.style.left = '10px';
                    }
                });
                
                markersList.appendChild(li);
            });
        }
        
        // æœç´¢åŠŸèƒ½
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            const filteredMarkers = allMarkers.filter(marker => {
                const name = marker.text || '';
                return name.toLowerCase().includes(searchTerm);
            });
            
            createMarkersList(filteredMarkers);
        });
        
        // åˆå§‹åŒ–æ ‡è®°ç‚¹åˆ—è¡¨
        createMarkersList(allMarkers);

    </script>

    <!-- ä¸–ç•Œåˆ‡æ¢æŒ‰é’® -->
    <div class="dimension-switcher">
        <button class="dimension-btn active" onclick="window.location.href='../overworld/index.html'">
            <span class="dimension-icon">ğŸŒ</span>
            <span class="dimension-label">ä¸»ä¸–ç•Œ</span>
        </button>
        <button class="dimension-btn" onclick="window.location.href='../end/index.html'">
            <span class="dimension-icon">ğŸŒ™</span>
            <span class="dimension-label">æœ«åœ°</span>
        </button>
        <button class="dimension-btn" onclick="window.location.href='../neither/index.html'">
            <span class="dimension-icon">ğŸ”¥</span>
            <span class="dimension-label">ä¸‹ç•Œ</span>
        </button>
    </div>
</body>

</html>